## 并发与并行区别

### 并发（Concurrency）

**前言**

> 早期计算机的 CPU 都是单核的，一个 CPU 在同一时间只能执行一个进程/线程，当系统中有多个进程/线程等待执行时，CPU 只能执行完一个再执行下一个。

计算机在运行过程中，有很多指令会涉及 I/O 操作，而 I/O 操作又是相当耗时的，速度远远低于 CPU，这导致 CPU 经常处于空闲状态，只能等待 I/O 操作完成后才能继续执行后面的指令。

为了提高 CPU 利用率，减少等待时间，人们提出了一种 CPU 并发工作的理论。

所谓并发，就是通过**一种算法将 CPU 资源合理地分配给多个任务**，当一个任务执行 I/O 操作时，**CPU 可以转而执行其它的任务**，等到 I/O 操作完成以后，或者**新的任务遇到 I/O 操作时，CPU 再回到原来的任务继续执行**。

两个任务的**并发任务执行**

![img](https://blog-img-qrx.oss-cn-beijing.aliyuncs.com/img/1515363219-0.gif)

虽然 CPU 在**同一时刻只能执行一个任务**，但是**通过将 CPU 的使用权在恰当的时机分配给不同的任务**，使得多个任务在视觉上看起来是一起执行的**。CPU 的执行速度极快，多任务切换的时间也极短，用户根本感受不到，所以并发执行看起来才跟真的一样**。

操作系统负责**将有限的 CPU 资源分配给不同的任务**，但是**不同操作系统的分配方式不太一样**，常见的有：

- 当检测到正在执行的任务进行 I/O 操作时，就将 CPU 资源分配给其它任务。
- 将 CPU 时间平均分配给各个任务，**每个任务都可以获得 CPU 的使用权。在给定的时间内，即使任务没有执行完成，也要将 CPU 资源分配给其它任务，该任务需要等待下次分配 CPU 使用权后再继续执行。**


将 **CPU 资源合理地分配给多个任务共同使用，有效避免了 CPU 被某个任务长期霸占的问题，极大地提升了 CPU 资源利用率**。

### 并行（Parallelism）

并发是针对单核 CPU 提出的，而并行则是针对多核 CPU 提出的。和单核 CPU 不同，多核 CPU 真正实现了“同时执行多个任务”。

> 多核 CPU 内部集成了多个计算核心（Core），每个核心相当于一个简单的 CPU，如果不计较细节，你可以认为给计算机安装了多个独立的 CPU。

多核 **CPU 的每个核心都可以独立地执行一个任务**，而且**多个核心之间不会相互干扰。在不同核心上执行的多个任务**，是真正地同时运行，这种状态就叫做并行。

例如，同样是执行两个任务，双核 CPU 的工作状态如下图所示：

![img](https://blog-img-qrx.oss-cn-beijing.aliyuncs.com/img/15153644a-1.gif)

### 并发+并行

在图2中，执行任务的数量恰好等于 CPU 核心的数量，是一种理想状态。但是在实际场景中，处于运行状态的任务是非常多的，尤其是电脑和手机，开机就几十个任务，而 CPU 往往只有 4 核、8 核或者 16 核，远低于任务的数量，这个时候就会同时存在并发和并行两种情况：所有核心都要并行工作，并且每个核心还要并发工作。

例如一个双核 CPU 要执行四个任务，它的工作状态如下图所示：



![img](https://blog-img-qrx.oss-cn-beijing.aliyuncs.com/img/15153613F-2.gif)



每个核心并发执行两个任务，两个核心并行的话就能执行四个任务。当然也可以一个核心执行一个任务，另一个核心并发执行三个任务，这跟操作系统的分配方式，以及每个任务的工作状态有关系。

## 总结

并发针对**单核 CPU 而言，它指的是 CPU 交替执行不同任务的能力**；并行针对多核 CPU 而言，它指的**是多个核心同时执行多个任务的能力**。

单核 CPU 只能并发，无法并行；换句话说，**并行只可能发生在多核 CPU 中**。

在多核 CPU 中，**并发和并行一般都会同时存在，它们都是提高 CPU 处理任务能力的重要手段**。